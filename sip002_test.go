package main

import (
	"encoding/base64"
	"testing"
)

func TestSipRequest(t *testing.T) {
	url := "https://api.pay.pm/api/v1/link/sip002?token=d9ogaIbsJlLJXqgf"
	sipConfig, err := requestSipConfig(url)
	if nil != err {
		t.Error(err)
	}
	t.Log(sipConfig)
}

func TestBase64(t *testing.T) {
	resp := "c3M6Ly9ZMmhoWTJoaE1qQXRhV1YwWmkxd2IyeDVNVE13TlRwWU0zbERjVElAaWVwbC5oay40N2M5LjZpbjQuZGV2OjIxMjQwLz9wbHVnaW49b2Jmcy1sb2NhbCUzQm9iZnMlM0R0bHMlM0JvYmZzLWhvc3QlM0Rkcy5kb3dubG9hZC53aW5kb3dzdXBkYXRlLmNvbSNIb25nJTIwS29uZyUyMDAxCnNzOi8vWTJoaFkyaGhNakF0YVdWMFppMXdiMng1TVRNd05UcFlNM2xEY1RJQGllcGwuaGsuNGJlZS42aW40LmRldjoyMTI0MC8/cGx1Z2luPW9iZnMtbG9jYWwlM0JvYmZzJTNEdGxzJTNCb2Jmcy1ob3N0JTNEZHMuZG93bmxvYWQud2luZG93c3VwZGF0ZS5jb20jSG9uZyUyMEtvbmclMjAwMgpzczovL1kyaGhZMmhoTWpBdGFXVjBaaTF3YjJ4NU1UTXdOVHBZTTNsRGNUSUBpZXBsLmhrLjk0ZjYuNmluNC5kZXY6MjEyNDAvP3BsdWdpbj1vYmZzLWxvY2FsJTNCb2JmcyUzRHRscyUzQm9iZnMtaG9zdCUzRGRzLmRvd25sb2FkLndpbmRvd3N1cGRhdGUuY29tI0hvbmclMjBLb25nJTIwMDMKc3M6Ly9ZMmhoWTJoaE1qQXRhV1YwWmkxd2IyeDVNVE13TlRwWU0zbERjVElAaWVwbC5oay4zNDM0LjZpbjQuZGV2OjIxMjQwLz9wbHVnaW49b2Jmcy1sb2NhbCUzQm9iZnMlM0R0bHMlM0JvYmZzLWhvc3QlM0Rkcy5kb3dubG9hZC53aW5kb3dzdXBkYXRlLmNvbSNIb25nJTIwS29uZyUyMDA0CnNzOi8vWTJoaFkyaGhNakF0YVdWMFppMXdiMng1TVRNd05UcFlNM2xEY1RJQGllcGwuaGsuNmQ1Ny42aW40LmRldjoyMTI0MC8/cGx1Z2luPW9iZnMtbG9jYWwlM0JvYmZzJTNEdGxzJTNCb2Jmcy1ob3N0JTNEZHMuZG93bmxvYWQud2luZG93c3VwZGF0ZS5jb20jSG9uZyUyMEtvbmclMjAwNQpzczovL1kyaGhZMmhoTWpBdGFXVjBaaTF3YjJ4NU1UTXdOVHBZTTNsRGNUSUBpZXBsLmhrLmI4YzMuNmluNC5kZXY6MjEyNDAvP3BsdWdpbj1vYmZzLWxvY2FsJTNCb2JmcyUzRHRscyUzQm9iZnMtaG9zdCUzRGRzLmRvd25sb2FkLndpbmRvd3N1cGRhdGUuY29tI0hvbmclMjBLb25nJTIwMDYKc3M6Ly9ZMmhoWTJoaE1qQXRhV1YwWmkxd2IyeDVNVE13TlRwWU0zbERjVElAaWVwbC5oay43ZjViLjZpbjQuZGV2OjIxMjQwLz9wbHVnaW49b2Jmcy1sb2NhbCUzQm9iZnMlM0R0bHMlM0JvYmZzLWhvc3QlM0Rkcy5kb3dubG9hZC53aW5kb3dzdXBkYXRlLmNvbSNIb25nJTIwS29uZyUyMDA3CnNzOi8vWTJoaFkyaGhNakF0YVdWMFppMXdiMng1TVRNd05UcFlNM2xEY1RJQGllcGwuaGsuZDkzNC42aW40LmRldjoyMTI0MC8/cGx1Z2luPW9iZnMtbG9jYWwlM0JvYmZzJTNEdGxzJTNCb2Jmcy1ob3N0JTNEZHMuZG93bmxvYWQud2luZG93c3VwZGF0ZS5jb20jSG9uZyUyMEtvbmclMjAwOApzczovL1kyaGhZMmhoTWpBdGFXVjBaaTF3YjJ4NU1UTXdOVHBZTTNsRGNUSUBpZXBsLmhrLjczOGIuNmluNC5kZXY6MjEyNDAvP3BsdWdpbj1vYmZzLWxvY2FsJTNCb2JmcyUzRHRscyUzQm9iZnMtaG9zdCUzRGRzLmRvd25sb2FkLndpbmRvd3N1cGRhdGUuY29tI0hvbmclMjBLb25nJTIwMDkKc3M6Ly9ZMmhoWTJoaE1qQXRhV1YwWmkxd2IyeDVNVE13TlRwWU0zbERjVElAaWVwbC5oay5hMTg0LjZpbjQuZGV2OjIxMjQwLz9wbHVnaW49b2Jmcy1sb2NhbCUzQm9iZnMlM0R0bHMlM0JvYmZzLWhvc3QlM0Rkcy5kb3dubG9hZC53aW5kb3dzdXBkYXRlLmNvbSNIb25nJTIwS29uZyUyMDEwCnNzOi8vWTJoaFkyaGhNakF0YVdWMFppMXdiMng1TVRNd05UcFlNM2xEY1RJQGllcGwuaGsuMjZhMi42aW40LmRldjoyMTI0MC8/cGx1Z2luPW9iZnMtbG9jYWwlM0JvYmZzJTNEdGxzJTNCb2Jmcy1ob3N0JTNEZHMuZG93bmxvYWQud2luZG93c3VwZGF0ZS5jb20jSG9uZyUyMEtvbmclMjAxMQpzczovL1kyaGhZMmhoTWpBdGFXVjBaaTF3YjJ4NU1UTXdOVHBZTTNsRGNUSUBpZXBsLmhrLmI2MTEuNmluNC5kZXY6MjEyNDAvP3BsdWdpbj1vYmZzLWxvY2FsJTNCb2JmcyUzRHRscyUzQm9iZnMtaG9zdCUzRGRzLmRvd25sb2FkLndpbmRvd3N1cGRhdGUuY29tI0hvbmclMjBLb25nJTIwMTIKc3M6Ly9ZMmhoWTJoaE1qQXRhV1YwWmkxd2IyeDVNVE13TlRwWU0zbERjVElAaWVwbC5oay5jOGZiLjZpbjQuZGV2OjIxMjQwLz9wbHVnaW49b2Jmcy1sb2NhbCUzQm9iZnMlM0R0bHMlM0JvYmZzLWhvc3QlM0Rkcy5kb3dubG9hZC53aW5kb3dzdXBkYXRlLmNvbSNIb25nJTIwS29uZyUyMDEzCnNzOi8vWTJoaFkyaGhNakF0YVdWMFppMXdiMng1TVRNd05UcFlNM2xEY1RJQGllcGwuaGsuNWE2NC42aW40LmRldjoyMTI0MC8/cGx1Z2luPW9iZnMtbG9jYWwlM0JvYmZzJTNEdGxzJTNCb2Jmcy1ob3N0JTNEZHMuZG93bmxvYWQud2luZG93c3VwZGF0ZS5jb20jSG9uZyUyMEtvbmclMjAxNApzczovL1kyaGhZMmhoTWpBdGFXVjBaaTF3YjJ4NU1UTXdOVHBZTTNsRGNUSUBpZXBsLmhrLjBiM2YuNmluNC5kZXY6MjEyNDAvP3BsdWdpbj1vYmZzLWxvY2FsJTNCb2JmcyUzRHRscyUzQm9iZnMtaG9zdCUzRGRzLmRvd25sb2FkLndpbmRvd3N1cGRhdGUuY29tI0hvbmclMjBLb25nJTIwMTUKc3M6Ly9ZMmhoWTJoaE1qQXRhV1YwWmkxd2IyeDVNVE13TlRwWU0zbERjVElAaWVwbC5oay5iODY1LjZpbjQuZGV2OjIxMjQwLz9wbHVnaW49b2Jmcy1sb2NhbCUzQm9iZnMlM0R0bHMlM0JvYmZzLWhvc3QlM0Rkcy5kb3dubG9hZC53aW5kb3dzdXBkYXRlLmNvbSNIb25nJTIwS29uZyUyMDE2CnNzOi8vWTJoaFkyaGhNakF0YVdWMFppMXdiMng1TVRNd05UcFlNM2xEY1RJQGllcGwuanAuZDM3OC42aW40LmRldjoyMTI0MC8/cGx1Z2luPW9iZnMtbG9jYWwlM0JvYmZzJTNEdGxzJTNCb2Jmcy1ob3N0JTNEZHMuZG93bmxvYWQud2luZG93c3VwZGF0ZS5jb20jSmFwYW4lMjAwMSUyMHwlMjBNZWRpYQpzczovL1kyaGhZMmhoTWpBdGFXVjBaaTF3YjJ4NU1UTXdOVHBZTTNsRGNUSUBpZXBsLmpwLjI3OWQuNmluNC5kZXY6MjEyNDAvP3BsdWdpbj1vYmZzLWxvY2FsJTNCb2JmcyUzRHRscyUzQm9iZnMtaG9zdCUzRGRzLmRvd25sb2FkLndpbmRvd3N1cGRhdGUuY29tI0phcGFuJTIwMDIlMjB8JTIwTWVkaWEKc3M6Ly9ZMmhoWTJoaE1qQXRhV1YwWmkxd2IyeDVNVE13TlRwWU0zbERjVElAaWVwbC5qcC43MGJhLjZpbjQuZGV2OjIxMjQwLz9wbHVnaW49b2Jmcy1sb2NhbCUzQm9iZnMlM0R0bHMlM0JvYmZzLWhvc3QlM0Rkcy5kb3dubG9hZC53aW5kb3dzdXBkYXRlLmNvbSNKYXBhbiUyMDAzJTIwfCUyME1lZGlhCnNzOi8vWTJoaFkyaGhNakF0YVdWMFppMXdiMng1TVRNd05UcFlNM2xEY1RJQGllcGwuanAuZjI0Zi42aW40LmRldjoyMTI0MC8/cGx1Z2luPW9iZnMtbG9jYWwlM0JvYmZzJTNEdGxzJTNCb2Jmcy1ob3N0JTNEZHMuZG93bmxvYWQud2luZG93c3VwZGF0ZS5jb20jSmFwYW4lMjAwNCUyMHwlMjBNZWRpYQpzczovL1kyaGhZMmhoTWpBdGFXVjBaaTF3YjJ4NU1UTXdOVHBZTTNsRGNUSUBpZXBsLmpwLmRlMGEuNmluNC5kZXY6MjEyNDAvP3BsdWdpbj1vYmZzLWxvY2FsJTNCb2JmcyUzRHRscyUzQm9iZnMtaG9zdCUzRGRzLmRvd25sb2FkLndpbmRvd3N1cGRhdGUuY29tI0phcGFuJTIwMDUlMjB8JTIwTWVkaWEKc3M6Ly9ZMmhoWTJoaE1qQXRhV1YwWmkxd2IyeDVNVE13TlRwWU0zbERjVElAaWVwbC5qcC5hZWMzLjZpbjQuZGV2OjIxMjQwLz9wbHVnaW49b2Jmcy1sb2NhbCUzQm9iZnMlM0R0bHMlM0JvYmZzLWhvc3QlM0Rkcy5kb3dubG9hZC53aW5kb3dzdXBkYXRlLmNvbSNKYXBhbiUyMDA2JTIwfCUyME1lZGlhCnNzOi8vWTJoaFkyaGhNakF0YVdWMFppMXdiMng1TVRNd05UcFlNM2xEY1RJQGllcGwuc2cuODA1OS42aW40LmRldjoyMTI0MC8/cGx1Z2luPW9iZnMtbG9jYWwlM0JvYmZzJTNEdGxzJTNCb2Jmcy1ob3N0JTNEZHMuZG93bmxvYWQud2luZG93c3VwZGF0ZS5jb20jU2luZ2Fwb3JlJTIwMDElMjB8JTIwTWVkaWEKc3M6Ly9ZMmhoWTJoaE1qQXRhV1YwWmkxd2IyeDVNVE13TlRwWU0zbERjVElAaWVwbC5zZy5hM2IyLjZpbjQuZGV2OjIxMjQwLz9wbHVnaW49b2Jmcy1sb2NhbCUzQm9iZnMlM0R0bHMlM0JvYmZzLWhvc3QlM0Rkcy5kb3dubG9hZC53aW5kb3dzdXBkYXRlLmNvbSNTaW5nYXBvcmUlMjAwMiUyMHwlMjBNZWRpYQpzczovL1kyaGhZMmhoTWpBdGFXVjBaaTF3YjJ4NU1UTXdOVHBZTTNsRGNUSUBpZXBsLnNnLjZjOGYuNmluNC5kZXY6MjEyNDAvP3BsdWdpbj1vYmZzLWxvY2FsJTNCb2JmcyUzRHRscyUzQm9iZnMtaG9zdCUzRGRzLmRvd25sb2FkLndpbmRvd3N1cGRhdGUuY29tI1NpbmdhcG9yZSUyMDAzJTIwfCUyME1lZGlhCnNzOi8vWTJoaFkyaGhNakF0YVdWMFppMXdiMng1TVRNd05UcFlNM2xEY1RJQGllcGwuc2cuZjk3OC42aW40LmRldjoyMTI0MC8/cGx1Z2luPW9iZnMtbG9jYWwlM0JvYmZzJTNEdGxzJTNCb2Jmcy1ob3N0JTNEZHMuZG93bmxvYWQud2luZG93c3VwZGF0ZS5jb20jU2luZ2Fwb3JlJTIwMDQlMjB8JTIwTWVkaWEKc3M6Ly9ZMmhoWTJoaE1qQXRhV1YwWmkxd2IyeDVNVE13TlRwWU0zbERjVElAaWVwbC5zZy5kNDY0LjZpbjQuZGV2OjIxMjQwLz9wbHVnaW49b2Jmcy1sb2NhbCUzQm9iZnMlM0R0bHMlM0JvYmZzLWhvc3QlM0Rkcy5kb3dubG9hZC53aW5kb3dzdXBkYXRlLmNvbSNTaW5nYXBvcmUlMjAwNSUyMHwlMjBNZWRpYQpzczovL1kyaGhZMmhoTWpBdGFXVjBaaTF3YjJ4NU1UTXdOVHBZTTNsRGNUSUBpZXBsLnNnLjRhZGQuNmluNC5kZXY6MjEyNDAvP3BsdWdpbj1vYmZzLWxvY2FsJTNCb2JmcyUzRHRscyUzQm9iZnMtaG9zdCUzRGRzLmRvd25sb2FkLndpbmRvd3N1cGRhdGUuY29tI1NpbmdhcG9yZSUyMDA2JTIwfCUyME1lZGlhCnNzOi8vWTJoaFkyaGhNakF0YVdWMFppMXdiMng1TVRNd05UcFlNM2xEY1RJQGllcGwudHcuYW92My42aW40LmRldjoyMTI0MC8/cGx1Z2luPW9iZnMtbG9jYWwlM0JvYmZzJTNEdGxzJTNCb2Jmcy1ob3N0JTNEZHMuZG93bmxvYWQud2luZG93c3VwZGF0ZS5jb20jVGFpd2FuJTIwMDElMjB8JTIwU2hlbnpoZW4Kc3M6Ly9ZMmhoWTJoaE1qQXRhV1YwWmkxd2IyeDVNVE13TlRwWU0zbERjVElAaWVwbC50dy4yN2c0LjZpbjQuZGV2OjIxMjQwLz9wbHVnaW49b2Jmcy1sb2NhbCUzQm9iZnMlM0R0bHMlM0JvYmZzLWhvc3QlM0Rkcy5kb3dubG9hZC53aW5kb3dzdXBkYXRlLmNvbSNUYWl3YW4lMjAwMiUyMHwlMjBTaGVuemhlbgpzczovL1kyaGhZMmhoTWpBdGFXVjBaaTF3YjJ4NU1UTXdOVHBZTTNsRGNUSUBpZXBsLnR3LjEwdjMuNmluNC5kZXY6MjEyNDAvP3BsdWdpbj1vYmZzLWxvY2FsJTNCb2JmcyUzRHRscyUzQm9iZnMtaG9zdCUzRGRzLmRvd25sb2FkLndpbmRvd3N1cGRhdGUuY29tI1RhaXdhbiUyMDAzJTIwfCUyMFNoZW56aGVuCnNzOi8vWTJoaFkyaGhNakF0YVdWMFppMXdiMng1TVRNd05UcFlNM2xEY1RJQGllcGwudHcuNTkxZi42aW40LmRldjoyMTI0MC8/cGx1Z2luPW9iZnMtbG9jYWwlM0JvYmZzJTNEdGxzJTNCb2Jmcy1ob3N0JTNEZHMuZG93bmxvYWQud2luZG93c3VwZGF0ZS5jb20jVGFpd2FuJTIwMDQlMjB8JTIwU2hlbnpoZW4Kc3M6Ly9ZMmhoWTJoaE1qQXRhV1YwWmkxd2IyeDVNVE13TlRwWU0zbERjVElAaWVwbC51cy42NzEzLjZpbjQuZGV2OjIxMjQwLz9wbHVnaW49b2Jmcy1sb2NhbCUzQm9iZnMlM0R0bHMlM0JvYmZzLWhvc3QlM0Rkcy5kb3dubG9hZC53aW5kb3dzdXBkYXRlLmNvbSNVbml0ZWQlMjBTdGF0ZXMlMjAwMSUyMHwlMjBNZWRpYQpzczovL1kyaGhZMmhoTWpBdGFXVjBaaTF3YjJ4NU1UTXdOVHBZTTNsRGNUSUBpZXBsLnVzLjAyNTUuNmluNC5kZXY6MjEyNDAvP3BsdWdpbj1vYmZzLWxvY2FsJTNCb2JmcyUzRHRscyUzQm9iZnMtaG9zdCUzRGRzLmRvd25sb2FkLndpbmRvd3N1cGRhdGUuY29tI1VuaXRlZCUyMFN0YXRlcyUyMDAyJTIwfCUyME1lZGlhCnNzOi8vWTJoaFkyaGhNakF0YVdWMFppMXdiMng1TVRNd05UcFlNM2xEY1RJQGllcGwudXMuZjA3Zi42aW40LmRldjoyMTI0MC8/cGx1Z2luPW9iZnMtbG9jYWwlM0JvYmZzJTNEdGxzJTNCb2Jmcy1ob3N0JTNEZHMuZG93bmxvYWQud2luZG93c3VwZGF0ZS5jb20jVW5pdGVkJTIwU3RhdGVzJTIwMDMlMjB8JTIwTWVkaWEKc3M6Ly9ZMmhoWTJoaE1qQXRhV1YwWmkxd2IyeDVNVE13TlRwWU0zbERjVElAaWVwbC51cy4wODdiLjZpbjQuZGV2OjIxMjQwLz9wbHVnaW49b2Jmcy1sb2NhbCUzQm9iZnMlM0R0bHMlM0JvYmZzLWhvc3QlM0Rkcy5kb3dubG9hZC53aW5kb3dzdXBkYXRlLmNvbSNVbml0ZWQlMjBTdGF0ZXMlMjAwNCUyMHwlMjBNZWRpYQpzczovL1kyaGhZMmhoTWpBdGFXVjBaaTF3YjJ4NU1UTXdOVHBZTTNsRGNUSUBpZXBsLnVzLjAxZTUuNmluNC5kZXY6MjEyNDAvP3BsdWdpbj1vYmZzLWxvY2FsJTNCb2JmcyUzRHRscyUzQm9iZnMtaG9zdCUzRGRzLmRvd25sb2FkLndpbmRvd3N1cGRhdGUuY29tI1VuaXRlZCUyMFN0YXRlcyUyMDA1JTIwfCUyME1lZGlhCg=="
	plainText, err := decodeStdBase64(resp)
	if nil != err {
		t.Error(err)
	}
	t.Log(plainText)
}

func TestSIP002(t *testing.T) {
	sip := "ss://Y2hhY2hhMjAtaWV0Zi1wb2x5MTMwNTpYM3lDcTI@iepl.us.f07f.6in4.dev:21240/?plugin=obfs-local%3Bobfs%3Dtls%3Bobfs-host%3Dds.download.windowsupdate.com#United%20States%2003%20|%20Media"
	sip002, err := parseSipConfig(sip)
	if nil != err {
		t.Error(err)
	} else {
		t.Log(sip002)
	}
}

func decodeStdBase64(text string) (string, error) {
	plain, err := base64.StdEncoding.DecodeString(text)
	return string(plain), err
}
